<%- include('../partials/header', { page: 'admin' }) %>

<main class="admin-main">
    <div class="admin-container">
        <!-- Header del Admin -->
        <div class="admin-header">
            <div class="admin-breadcrumb">
                <a href="/admin" class="breadcrumb-link">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-current">Seguridad</span>
            </div>
            
            <h1 class="admin-title">
                <i class="fas fa-shield-alt"></i>
                Panel de Seguridad
            </h1>
            
            <p class="admin-subtitle">
                Monitoreo y configuración de la seguridad del sistema
            </p>
        </div>

        <!-- Estadísticas de Seguridad -->
        <div class="security-stats">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-user-shield"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number"><%= securityStats.totalLoginAttempts %></div>
                    <div class="stat-label">Intentos de Login (24h)</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number"><%= securityStats.failedAttempts %></div>
                    <div class="stat-label">Intentos Fallidos</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-ban"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number"><%= securityStats.blockedIPs %></div>
                    <div class="stat-label">IPs Bloqueadas</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number"><%= securityStats.successfulLogins %></div>
                    <div class="stat-label">Logins Exitosos</div>
                </div>
            </div>
        </div>

        <!-- Logs de Seguridad Recientes -->
        <div class="security-section">
            <h3 class="section-title">
                <i class="fas fa-list-alt"></i>
                Eventos de Seguridad Recientes
            </h3>
            
            <div class="security-logs">
                <% if (securityLogs && securityLogs.length > 0) { %>
                    <% securityLogs.forEach(log => { %>
                        <div class="log-entry <%= log.event === 'failed_login' ? 'log-warning' : 'log-success' %>">
                            <div class="log-time">
                                <%= new Date(log.timestamp).toLocaleString() %>
                            </div>
                            <div class="log-content">
                                <div class="log-event">
                                    <i class="fas fa-<%= log.event === 'failed_login' ? 'times-circle' : 'check-circle' %>"></i>
                                    <%= log.event === 'failed_login' ? 'Login Fallido' : 'Login Exitoso' %>
                                </div>
                                <div class="log-details">
                                    <span class="log-ip">IP: <%= log.data.ip %></span>
                                    <% if (log.data.email) { %>
                                        <span class="log-email">Email: <%= log.data.email %></span>
                                    <% } %>
                                    <% if (log.data.reason) { %>
                                        <span class="log-reason">Razón: <%= log.data.reason %></span>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                <% } else { %>
                    <div class="no-logs">
                        <i class="fas fa-info-circle"></i>
                        No hay eventos de seguridad registrados
                    </div>
                <% } %>
            </div>
        </div>

        <!-- Configuración de Seguridad -->
        <div class="security-section">
            <h3 class="section-title">
                <i class="fas fa-cog"></i>
                Configuración de Seguridad
            </h3>
            
            <div class="security-config">
                <div class="config-item">
                    <div class="config-label">
                        <i class="fas fa-clock"></i>
                        Tiempo de Bloqueo por Intentos Fallidos
                    </div>
                    <div class="config-value">15 minutos</div>
                </div>
                
                <div class="config-item">
                    <div class="config-label">
                        <i class="fas fa-hashtag"></i>
                        Máximo de Intentos de Login
                    </div>
                    <div class="config-value">5 intentos</div>
                </div>
                
                <div class="config-item">
                    <div class="config-label">
                        <i class="fas fa-shield-alt"></i>
                        Rate Limiting General
                    </div>
                    <div class="config-value">100 requests/15min</div>
                </div>
                
                <div class="config-item">
                    <div class="config-label">
                        <i class="fas fa-user-plus"></i>
                        Rate Limiting Registro
                    </div>
                    <div class="config-value">3 registros/hora</div>
                </div>
            </div>
        </div>

        <!-- Acciones de Seguridad -->
        <div class="security-section">
            <h3 class="section-title">
                <i class="fas fa-tools"></i>
                Acciones de Seguridad
            </h3>
            
            <div class="security-actions">
                <button class="action-btn btn-warning" onclick="clearSecurityLogs()">
                    <i class="fas fa-trash-alt"></i>
                    Limpiar Logs de Seguridad
                </button>
                
                <button class="action-btn btn-info" onclick="exportSecurityLogs()">
                    <i class="fas fa-download"></i>
                    Exportar Logs
                </button>
                
                <button class="action-btn btn-danger" onclick="resetFailedAttempts()">
                    <i class="fas fa-refresh"></i>
                    Reset Intentos Fallidos
                </button>
            </div>
        </div>
    </div>
</main>

<style>
.security-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin: 30px 0;
}

.stat-card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    display: flex;
    align-items: center;
    gap: 20px;
}

.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: white;
}

.stat-card:nth-child(1) .stat-icon { background: linear-gradient(135deg, #667eea, #764ba2); }
.stat-card:nth-child(2) .stat-icon { background: linear-gradient(135deg, #f093fb, #f5576c); }
.stat-card:nth-child(3) .stat-icon { background: linear-gradient(135deg, #4facfe, #00f2fe); }
.stat-card:nth-child(4) .stat-icon { background: linear-gradient(135deg, #43e97b, #38f9d7); }

.stat-number {
    font-size: 28px;
    font-weight: bold;
    color: #333;
}

.stat-label {
    font-size: 14px;
    color: #666;
}

.security-section {
    background: white;
    border-radius: 15px;
    padding: 30px;
    margin: 30px 0;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.section-title {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 25px;
    color: #333;
    font-size: 20px;
}

.log-entry {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 10px;
    border-left: 4px solid;
}

.log-warning {
    background: #fff5f5;
    border-left-color: #e53e3e;
}

.log-success {
    background: #f0fff4;
    border-left-color: #38a169;
}

.log-time {
    font-size: 12px;
    color: #666;
    min-width: 150px;
}

.log-event {
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 8px;
}

.log-details {
    font-size: 12px;
    color: #666;
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.config-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 0;
    border-bottom: 1px solid #eee;
}

.config-label {
    display: flex;
    align-items: center;
    gap: 10px;
    color: #333;
}

.config-value {
    font-weight: bold;
    color: #667eea;
}

.security-actions {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.action-btn {
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
}

.btn-warning { background: #ed8936; color: white; }
.btn-info { background: #3182ce; color: white; }
.btn-danger { background: #e53e3e; color: white; }

.action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.no-logs {
    text-align: center;
    padding: 40px;
    color: #666;
    font-style: italic;
}
</style>

<script>
function clearSecurityLogs() {
    if (confirm('¿Estás seguro de que quieres limpiar todos los logs de seguridad?')) {
        // Implementar llamada AJAX para limpiar logs
        alert('Funcionalidad en desarrollo');
    }
}

function exportSecurityLogs() {
    // Implementar exportación de logs
    alert('Funcionalidad en desarrollo');
}

function resetFailedAttempts() {
    if (confirm('¿Estás seguro de que quieres resetear todos los intentos fallidos?')) {
        // Implementar reset de intentos fallidos
        alert('Funcionalidad en desarrollo');
    }
}
</script>

<%- include('../partials/footer') %>
