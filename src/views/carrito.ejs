<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/css/carrito.css">
    <link rel="stylesheet" href="/css/animations.css">
    <title>ðŸ›’ PetShop Innovador - Carrito de Compras</title>
</head>
<body>
    <%- include('partials/header', { page: 'carrito' }) %>

    <main class="carrito-container">
        <div class="carrito-header animate-fadeInUp">
            <div class="back-button">
                <a href="/" class="btn-back">
                    <i class="fas fa-arrow-left"></i>
                    Seguir Comprando
                </a>
            </div>
            <h1><i class="fas fa-shopping-cart"></i> Mi Carrito de Compras</h1>
        </div>

        <% if (carrito && carrito.length > 0) { %>
            <div class="carrito-content animate-fadeInUp delay-1">
                <div class="carrito-items">
                    <% carrito.forEach((item, index) => { %>
                        <div class="carrito-item animate-fadeInLeft delay-<%= (index % 3) + 1 %>" data-product-id="<%= item.id %>">
                            <div class="item-image">
                                <img src="/images/products/<%= item.imagen || item.img || 'default.jpg' %>" alt="<%= item.nombre %>" onerror="this.src='/images/logo_petshop.jpeg'" />
                            </div>
                            <div class="item-details">
                                <h3><%= item.nombre %></h3>
                                <p class="item-price">$<%= item.precio %></p>
                            </div>
                            <div class="item-quantity">
                                <form action="/carrito/update/<%= item.id %>?_method=PUT" method="POST" class="quantity-form">
                                    <label for="cantidad-<%= item.id %>">Cantidad:</label>
                                    <div class="quantity-controls">
                                        <button type="button" class="qty-btn" onclick="decreaseQuantity(<%= item.id %>)">
                                            <i class="fas fa-minus"></i>
                                        </button>
                                        <input type="number" 
                                               id="cantidad-<%= item.id %>" 
                                               name="cantidad" 
                                               value="<%= item.cantidad %>" 
                                               min="1" 
                                               max="10"
                                               data-precio="<%= item.precio %>"
                                               onchange="updateQuantity(<%= item.id %>)">
                                        <button type="button" class="qty-btn" onclick="increaseQuantity(<%= item.id %>)">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>
                            <div class="item-total">
                                <p id="subtotal-<%= item.id %>" class="subtotal">$<%= (parseFloat(item.precio) * item.cantidad).toFixed(2) %></p>
                            </div>
                            <div class="item-actions">
                                <form action="/carrito/remove/<%= item.id %>?_method=DELETE" method="POST" class="remove-form">
                                    <button type="submit" class="btn-remove">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    <% }); %>
                </div>

                <div class="carrito-summary animate-fadeInRight delay-2">
                    <div class="summary-card">
                        <h3><i class="fas fa-calculator"></i> Resumen del Pedido</h3>
                        <div class="summary-row">
                            <span>Subtotal:</span>
                            <span>$<%= total %></span>
                        </div>
                        <div class="summary-row">
                            <span>EnvÃ­o:</span>
                            <span class="free-shipping">GRATIS</span>
                        </div>
                        <div class="summary-row total-row">
                            <span>Total:</span>
                            <span class="total-amount">$<%= total %></span>
                        </div>
                        
                        <div class="checkout-actions">
                            <% if (locals.isLoggedIn) { %>
                                <button class="btn-checkout" onclick="proceedToCheckout()">
                                    <i class="fas fa-credit-card"></i>
                                    Proceder al Pago
                                </button>
                            <% } else { %>
                                <a href="/users/login" class="btn-login">
                                    <i class="fas fa-user"></i>
                                    Iniciar SesiÃ³n para Continuar
                                </a>
                            <% } %>
                            
                            <form action="/carrito/clear" method="POST" class="clear-cart-form">
                                <button type="submit" class="btn-clear">
                                    <i class="fas fa-trash-alt"></i>
                                    Vaciar Carrito
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        <% } else { %>
            <div class="carrito-empty animate-bounceIn">
                <div class="empty-state">
                    <i class="fas fa-shopping-cart empty-icon"></i>
                    <h2>Tu carrito estÃ¡ vacÃ­o</h2>
                    <p>Â¡Descubre nuestros increÃ­bles productos para tu mascota!</p>
                    <a href="/" class="btn-shop">
                        <i class="fas fa-paw"></i>
                        Comenzar a Comprar
                    </a>
                </div>
            </div>
        <% } %>
    </main>

    <%- include('partials/footer') %>
    
    <script src="/js/carrito-functions.js"></script>
    <script src="/js/petshop-animations.js"></script>
</body>
</html>